import{w as u}from"./index.0cd93556.js";const g={isConnected:!1,messages:[],error:null,orgId:null},s=u(g);let n=null,l=null;const i=3e3;function p(){const r=window.location.hostname,o=window.location.port;return o==="5173"||o==="5174"||o==="5175"||o==="5176"?(console.log("[WS] Dev mode detected, using port 3001"),`ws://${r}:3001`):`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/ws`}function d(){if(n)return;const r=p();console.log(`[WS] Connecting to ${r}...`);try{n=new WebSocket(r)}catch(o){console.error("[WS] Failed to create WebSocket:",o),a();return}n.onopen=()=>{s.update(o=>({...o,isConnected:!0,error:null})),console.log("[WS] Connected successfully")},n.onmessage=o=>{try{const t={...JSON.parse(o.data),timestamp:Date.now()};if(t.type==="CONNECTED"){s.update(c=>({...c,orgId:t.payload.orgId})),console.log("[WS] Confirmed org:",t.payload.orgId);return}s.update(c=>({...c,messages:[t,...c.messages].slice(0,100)})),console.log("[WS] Received:",t.type)}catch(e){console.error("[WS] Error parsing message:",e)}},n.onerror=o=>{console.error("[WS] Error:",o),s.update(e=>({...e,error:"Connection error"}))},n.onclose=o=>{console.log("[WS] Disconnected, code:",o.code),s.update(e=>({...e,isConnected:!1})),n=null,a()}}function a(){l||(console.log(`[WS] Reconnecting in ${i/1e3}s...`),l=setTimeout(()=>{l=null,d()},i))}function S(){d()}export{S as i,s as w};
